# Sentry 테스트 및 검증 가이드

## 📋 테스트 시나리오

### 1. 기본 에러 추적 테스트

#### 인증 관련 에러

1. **토큰 만료 테스트**
   - 브라우저 개발자 도구에서 쿠키 삭제
   - API 호출 시 401 에러 발생 확인
   - Sentry에서 토큰 리프레시 실패 에러 확인

2. **네트워크 에러 테스트**
   - 네트워크 연결 끊고 API 호출
   - Sentry에서 네트워크 에러 확인

#### 파일 업로드 에러

1. **S3 업로드 실패 테스트**
   - 잘못된 파일 형식 업로드
   - 용량 초과 파일 업로드
   - Sentry에서 파일 업로드 에러 확인

### 2. 사용자 컨텍스트 테스트

1. **로그인 후 사용자 정보 설정**
   - 로그인 후 Sentry 대시보드에서 사용자 정보 확인
   - 에러 발생 시 사용자 정보 포함 여부 확인

2. **로그아웃 후 사용자 정보 제거**
   - 로그아웃 후 익명 사용자로 전환 확인

### 3. Breadcrumb 테스트

1. **API 호출 추적**
   - 페이지 내에서 여러 API 호출 수행
   - Sentry에서 API 호출 순서 및 상태 확인

2. **파일 업로드 과정 추적**
   - 파일 업로드 시 각 단계별 breadcrumb 확인

## 🔧 테스트 방법

### 개발 환경에서 테스트

1. **환경 변수 설정**

   ```env
   NEXT_PUBLIC_SENTRY_DSN=your-sentry-dsn
   ```

2. **강제 에러 발생 코드 (임시)**

   ```typescript
   // 임시 테스트 코드 (테스트 후 제거)
   const testSentry = () => {
     throw new Error("Sentry 테스트 에러");
   };
   ```

3. **콘솔에서 에러 확인**
   - 개발 환경에서는 console.error로도 출력됨
   - Sentry 대시보드에서도 동시에 확인

### 프로덕션 환경에서 테스트

1. **실제 사용자 시나리오 테스트**
   - 실제 앱 사용 중 발생할 수 있는 에러 상황 재현
   - 네트워크 불안정 상황 테스트

2. **모니터링 대시보드 확인**
   - 실시간 에러 발생 현황
   - 사용자별 에러 발생 패턴

## 📊 확인해야 할 Sentry 기능

### 1. 에러 추적

- [x] 에러 발생 시 스택 트레이스 포함
- [x] 에러 발생 시점 및 빈도
- [x] 에러별 태그 및 추가 정보 (extra)

### 2. 사용자 컨텍스트

- [x] 사용자 ID 및 이메일 정보
- [x] 에러 발생 시 사용자 정보 포함

### 3. Breadcrumb

- [x] API 호출 과정 추적
- [x] 파일 업로드 과정 추적
- [x] 사용자 액션 추적

### 4. 필터링

- [x] 404 에러 필터링
- [x] AbortError 필터링
- [x] 개발 환경 콘솔 출력

## 🚨 알림 설정

### 즉시 알림 (Slack/이메일)

- 5xx 서버 에러
- 파일 업로드 실패
- 토큰 리프레시 실패

### 일일 요약

- 에러 발생 현황
- 사용자 영향도
- 성능 지표 요약

## 📝 테스트 체크리스트

### 기본 기능

- [ ] Sentry 초기화 확인
- [ ] 에러 발생 시 Sentry 전송 확인
- [ ] 개발 환경 콘솔 출력 확인

### 에러 추적

- [ ] 인증 에러 추적 확인
- [ ] 파일 업로드 에러 추적 확인
- [ ] 네트워크 에러 추적 확인

### 사용자 컨텍스트

- [ ] 로그인 후 사용자 정보 설정 확인
- [ ] 에러 발생 시 사용자 정보 포함 확인

### Breadcrumb

- [ ] API 호출 과정 추적 확인
- [ ] 파일 업로드 과정 추적 확인

### 필터링

- [ ] 404 에러 필터링 확인
- [ ] AbortError 필터링 확인

## 🔍 디버깅 팁

### 에러가 Sentry에 전송되지 않는 경우

1. DSN 설정 확인
2. 네트워크 연결 확인
3. beforeSend 필터 확인

### 사용자 컨텍스트가 설정되지 않는 경우

1. 로그인 상태 확인
2. useMyInfoQuery 호출 확인
3. setUserContext 호출 확인

### Breadcrumb이 기록되지 않는 경우

1. addBreadcrumb 호출 확인
2. 함수 실행 순서 확인

## 📚 참고 자료

- [Sentry Next.js 공식 문서](https://docs.sentry.io/platforms/javascript/guides/nextjs/)
- [Sentry React 공식 문서](https://docs.sentry.io/platforms/javascript/guides/react/)
- [Sentry 에러 필터링 가이드](https://docs.sentry.io/platforms/javascript/configuration/filtering/)
